<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Gym Log">
    <title>Gym Assistant</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: sans-serif; max-width: 600px; margin: 40px auto; padding: 20px; background: #111; color: #eee; }
        h1 { font-size: 20px; }
        input { width: 100%; padding: 12px; font-size: 16px; background: #222; border: 2px solid #444; color: #eee; margin-bottom: 10px; }
        button { width: 100%; padding: 12px; font-size: 16px; background: #0f8; border: none; color: #000; font-weight: bold; cursor: pointer; }
        #logButton { width: 100%; padding: 12px; font-size: 16px; background: #0f8; border: none; color: #000; font-weight: bold; cursor: pointer; }
        #msg { padding: 15px; background: #222; margin: 20px 0; border-left: 4px solid #0f8; }
        .item { background: #222; padding: 10px; margin: 10px 0; border-left: 3px solid #444; display: flex; justify-content: space-between; align-items: center; }
        .item-content { flex: 1; }
        .ex { color: #0f8; font-weight: bold; }
        .dt { color: #888; font-size: 12px; }
        #install { background: #f80; padding: 15px; margin-bottom: 20px; border-radius: 8px; display: none; }
        #install button { background: #000; color: #f80; margin-top: 10px; }
        .del { background: #f44; color: #fff; border: none; padding: 8px 12px; cursor: pointer; font-size: 14px; border-radius: 4px; }
        .del:hover { background: #f66; }
    </style>
</head>
<body>
    <div id="install" style="display: none;">
        <strong>‚ö†Ô∏è Add to Home Screen</strong>
        <p>Safari deletes data after 7 days. Add this to your home screen to save workouts permanently!</p>
        <p style="font-size: 14px; margin-top: 10px;">Tap Share ‚Üí Add to Home Screen</p>
        <button onclick="document.getElementById('install').style.display='none'">Dismiss</button>
    </div>
    <h1>üí™ (Dead Simple) Gym Log</h1>
    <input id="i" placeholder="bench 8, 8, 7 x 100" autofocus>
    <button onclick="log()">Log</button>
    <div id="msg"></div>
    <div id="hist"></div>
    <script>
        const get = () => JSON.parse(localStorage.getItem('w') || '[]');
        const save = w => localStorage.setItem('w', JSON.stringify([...get(), w]));
        const saveAll = w => localStorage.setItem('w', JSON.stringify(w));

        function isHeavier(current, previous) {
            const toKg = (wt, unit) =>
                (unit === 'lbs' || unit === 'lb') ? wt * 0.453592 : wt;
            return toKg(current.wt, current.unit) > toKg(previous.wt, previous.unit);
        }

        function parse(t) {
            t = t.toLowerCase();
            const m = t.match(/(.+?)\s+([\d,\s]+)\s*x\s*(\d+)\s*(lbs?|kg)?/);
            if (!m) return null;
            return {
                ex: m[1].trim(),
                reps: m[2].split(',').map(r => +r.trim()),
                wt: +m[3],
                unit: m[4] || 'kg',
                date: Date.now()
            };
        }

        function log() {
            const input = document.getElementById('i');
            const w = parse(input.value);
            if (!w) { msg('Bad format. Try: "squat 5,5 x 100 kg" or "squat 10,8,6 x 225 lbs"'); return; }

            const hist = get().filter(x => x.ex === w.ex);
            const last = hist[hist.length - 1];

            save(w);

            if (!last) {
                msg(`${w.ex}: First time! üéâ`);
            } else {
                const curr = w.reps.reduce((a,b) => a+b, 0);
                const prev = last.reps.reduce((a,b) => a+b, 0);
                const comp = isHeavier(w, last) ? 'üí™ Heavier!' :
                    curr > prev ? 'üìà More reps!' :
                    isHeavier(last, w) ? 'üòì Lighter' :
                    curr < prev ? 'üòì Fewer reps' : 'üëç Same';
                msg(`Last: ${last.wt}${last.unit} x ${last.reps.join(',')}. ${comp}`);
            }

            input.value = '';
            show();
        }

        function del(index) {
            const all = get();
            all.splice(index, 1);
            saveAll(all);
            msg('Entry deleted');
            show();
        }

        function msg(t) { document.getElementById('msg').textContent = t; }

        function show() {
            const all = get();
            const h = all.slice(-10).reverse();
            document.getElementById('hist').innerHTML = h.map((w, i) => {
                const actualIndex = all.length - 10 + (9 - i);
                return `<div class="item">
                    <div class="item-content">
                        <div class="ex">${w.ex}</div>
                        <div>${w.wt}${w.unit} √ó ${w.reps.join(', ')}</div>
                        <div class="dt">${new Date(w.date).toLocaleString()}</div>
                    </div>
                    <button class="del" onclick="del(${actualIndex})">üóëÔ∏è</button>
                </div>`;
            }).join('');
        }

        document.getElementById('i').addEventListener('keydown', e => {
            if (e.key === 'Enter') {
                e.preventDefault();
                log();
            }
        });
        // Detect if running in Safari on iOS (not already installed)
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const isStandalone = window.navigator.standalone === true;

        // Show warning every time on iOS Safari unless running as standalone app
        if (isIos && !isStandalone) {
            document.getElementById('install').style.display = 'block';
        }
        show();
    </script>
</body>
</html>
